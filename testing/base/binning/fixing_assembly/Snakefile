
# 29.04.20
configfile: "/home/projects/ku-cbd/people/nurher/holoflow/testing/base/config.yaml"
##
# Assembly
##
rule assembly:
    input:
        read1="{projectpath}/04-MappedToHuman/{sample}_1.fastq",
        read2="{projectpath}/04-MappedToHuman/{sample}_2.fastq"

    output:
        "{projectpath}/05-Assembly/{sample}_file_to_remove"

    params:
        memory=expand("{memory}", memory=config['memory']),
        klist_megahit=expand("{klist_megahit}", klist_megahit=config['klist_megahit']),
        klist_spades=expand("{klist_spades}", klist_spades=config['klist_spades']),
        threads=expand("{threads}", threads=config['threads']),
        assembler=expand("{assembler}", assembler=config['assembler']),
        out_dir="{projectpath}/05-Assembly/{sample}_assembly",
        temp_assembly="{projectpath}/05-Assembly/{sample}_assembly/temp_assembly.fa"

    shell:
        """
        python ./holoflow/bin/holo-assembly.py -1 {input.read1} -2 {input.read2} -m {params.memory} -t {params.threads} -k_megahit {params.klist_megahit} -k_spades {params.klist_spades} -a {params.assembler} -o {params.out_dir} -empty_o {output} -temp_a {params.temp_assembly}
        """



configfile: "/home/projects/ku-cbd/people/nurher/holoflow/testing/base/config.yaml"

rule assembly_reformat:
    input:
        empt_file="{projectpath}/05-Assembly/{sample}_file_to_remove",
        stats_in="{projectpath}/04-MappedToHuman/{sample}.stats"
    output:
        "{projectpath}/05-Assembly/{sample}.stats"
    params:
        in_assembly="{projectpath}/05-Assembly/{sample}_assembly/temp_assembly.fa",
        out_assembly="{projectpath}/05-Assembly/{sample}_assembly/{sample}.fa",
        out_dir="{projectpath}/05-Assembly/{sample}_assembly"

    shell:
        """
        rm {input.empt_file} && python ./holoflow/bin/holo-assembly_reformat.py -in_a {params.in_assembly} -out_a {params.out_assembly} -st_in {input.stats_in} -st_out {params.out_dir}
        """
